import React, { useState, useEffect } from 'react';
import { Menu, X, ChevronRight, CornerDownRight, Plus, Minus, Info } from 'lucide-react';

const App = () => {
    const [activePage, setActivePage] = useState('intro');
    const [isSidebarOpen, setSidebarOpen] = useState(false);

    // --- DATI (Invariati) ---
    const generalRules = [
        "Le colazioni sono intercambiabili tra loro.",
        "I pranzi e le cene sono intercambiabili.",
        "I men√π possono essere ripetuti liberamente.",
        "Verdure di stagione (crude o cotte) sono libere.",
        "Condimento giornaliero: 30g olio EVO (3 cucchiai)."
    ];

    const fruitSubs = [
        { name: "Mela", amount: "150 g" },
        { name: "Arance / Ciliegie", amount: "200 g" },
        { name: "Albicocche / Pesche", amount: "250 g" },
        { name: "Fragole", amount: "300 g" },
        { name: "Cocomero", amount: "450 g" },
        { name: "Banana / Uva", amount: "100 g" },
    ];

    const mealsData = {
        breakfast: [
            {
                title: "Opzione Classica",
                items: [
                    { name: "Latte parz. scremato", amount: "150 g", subs: ["Yogurt magro 150 g"] },
                    { name: "Fette biscottate", amount: "40 g", subs: ["Pane 50 g", "Biscotti 40 g", "Cereali 40 g"] }
                ]
            },
            {
                title: "Opzione Veloce",
                items: [
                    { name: "T√® o caff√®", amount: "Libero", subs: [] },
                    { name: "Biscotti secchi", amount: "50 g", subs: ["Fette biscottate 50 g", "Cracker 50 g"] }
                ]
            },
            {
                title: "Opzione Salata",
                items: [
                    { name: "Spremuta", amount: "150 g", subs: [] },
                    { name: "Cracker", amount: "25 g", subs: ["Pane 35 g", "Grissini 30 g"] }
                ]
            }
        ],
        lunch: [
            {
                title: "Men√π 1 (Tacchino)",
                items: [
                    { name: "Pasta al pomodoro", amount: "80 g", subs: ["Riso 80 g", "Gnocchi 200 g", "Pane 90 g"] },
                    { name: "Petto di tacchino", amount: "80 g", subs: ["Carni magre 120 g", "Pesce magro 140 g"] },
                    { name: "Mela", amount: "150 g", subs: ["Vedi tabella frutta"] },
                    { name: "Pane", amount: "40 g", subs: ["Patate 150 g"] }
                ]
            },
            {
                title: "Men√π 2 (Vitellone)",
                items: [
                    { name: "Pasta in brodo", amount: "40 g", subs: ["Riso 40 g"] },
                    { name: "Vitellone", amount: "80 g", subs: ["Carni magre 80 g", "Pesce magro 100 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "100 g", subs: ["Patate 200 g + Pane 45 g"] }
                ]
            },
            {
                title: "Men√π 3 (Trota)",
                items: [
                    { name: "Pasta e fagioli", amount: "50g + 30g", subs: ["Riso e piselli"] },
                    { name: "Trota", amount: "110 g", subs: ["Pesce magro 110 g", "Carni magre 90 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "70 g", subs: [] }
                ]
            },
            {
                title: "Men√π 4 (Tortellini)",
                items: [
                    { name: "Tortellini", amount: "110 g", subs: ["Lasagne 280 g", "Riso freddo 170 g"] },
                    { name: "Prosciutto crudo", amount: "20 g", subs: ["Bresaola 50 g"] },
                    { name: "Mela", amount: "300 g", subs: ["Doppia razione frutta"] },
                    { name: "Pane", amount: "60 g", subs: [] }
                ]
            },
            {
                title: "Men√π 5 (Sogliola)",
                items: [
                    { name: "Riso al pomodoro", amount: "80 g", subs: ["Pasta 80 g"] },
                    { name: "Sogliola ai ferri", amount: "100 g", subs: ["Pesce magro 100 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "40 g", subs: [] }
                ]
            },
            {
                title: "Men√π 6 (Veloce)",
                items: [
                    { name: "Pane", amount: "150 g", subs: [] },
                    { name: "Prosciutto cotto", amount: "100 g", subs: ["Mozzarella 120 g", "Tonno 80 g"] },
                    { name: "Mela", amount: "150 g", subs: [] }
                ]
            }
        ],
        dinner: [
            {
                title: "Men√π 1 (Prosciutto)",
                items: [
                    { name: "Pasta in brodo", amount: "40 g", subs: ["Riso 40 g"] },
                    { name: "Prosciutto crudo", amount: "70 g", subs: ["Mozzarella 100 g", "2 Uova"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "40 g", subs: [] }
                ]
            },
            {
                title: "Men√π 2 (Mozzarella)",
                items: [
                    { name: "Zuppa con riso", amount: "20 g riso", subs: ["Minestrone + 15g pasta"] },
                    { name: "Mozzarella", amount: "100 g", subs: ["Stracchino 70 g", "Ricotta 150 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "60 g", subs: [] }
                ]
            },
            {
                title: "Men√π 3 (Formaggi)",
                items: [
                    { name: "Riso in brodo", amount: "40 g", subs: [] },
                    { name: "Parmigiano", amount: "50 g", subs: ["Formaggi stagionati 50 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "40 g", subs: [] }
                ]
            },
            {
                title: "Men√π 4 (Vitello)",
                items: [
                    { name: "Pasta in brodo", amount: "40 g", subs: [] },
                    { name: "Vitello ai ferri", amount: "120 g", subs: ["Pesce 140 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "50 g", subs: [] }
                ]
            },
            {
                title: "Men√π 5 (Cotto)",
                items: [
                    { name: "Pasta pomodoro", amount: "60 g", subs: [] },
                    { name: "Prosciutto cotto", amount: "60 g", subs: ["Tonno 80 g"] },
                    { name: "Mela", amount: "150 g", subs: [] },
                    { name: "Pane", amount: "30 g", subs: [] }
                ]
            },
            {
                title: "Men√π 6 (Pizza)",
                items: [
                    { name: "Pizza margherita", amount: "160 g", subs: [] },
                    { name: "Prosciutto cotto", amount: "60 g", subs: [] },
                    { name: "Mela", amount: "150 g", subs: [] }
                ]
            }
        ]
    };

    const toggleSidebar = () => setSidebarOpen(!isSidebarOpen);

    const renderContent = () => {
        if (activePage === 'intro') {
            return (
                <div className="animate-fade-in max-w-3xl mx-auto pt-6 px-4 md:px-12 pb-24 font-sans text-gray-900">
                    <div className="mb-8 text-center bg-green-50 p-6 rounded-2xl border border-green-100">
                        <div className="text-6xl mb-4">ü•ó</div>
                        <h1 className="text-3xl font-extrabold text-green-800 mb-2">Guida alla Dieta</h1>
                        <p className="text-green-700 text-xl">ASST Garda - 1600 Kcal</p>
                    </div>

                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-8">
                        <h2 className="text-2xl font-bold text-gray-900 mb-4 flex items-center gap-3">
                            <Info className="text-blue-500" size={32} />
                            Regole Importanti
                        </h2>
                        <ul className="space-y-4">
                            {generalRules.map((r, i) => (
                                <li key={i} className="flex gap-4 text-lg leading-relaxed items-start">
                                    <div className="min-w-[10px] h-[10px] mt-2.5 rounded-full bg-blue-400"></div>
                                    {r}
                                </li>
                            ))}
                        </ul>
                    </div>

                    <h2 className="text-2xl font-bold text-gray-900 mb-4 px-2">Sostituzioni Frutta üçé</h2>
                    <p className="text-gray-600 mb-4 px-2 text-lg">Se non vuoi la mela (150g), puoi mangiare:</p>
                    
                    <div className="grid gap-3">
                        {fruitSubs.map((f, i) => (
                            <div key={i} className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex justify-between items-center">
                                <span className="text-xl font-medium text-gray-800">{f.name}</span>
                                <span className="text-xl font-bold text-green-600 bg-green-50 px-3 py-1 rounded-lg">{f.amount}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const data = activePage === 'breakfast' ? mealsData.breakfast : (activePage === 'lunch' ? mealsData.lunch : mealsData.dinner);
        const emoji = activePage === 'breakfast' ? '‚òï' : (activePage === 'lunch' ? '‚òÄÔ∏è' : 'üåô');
        const title = activePage === 'breakfast' ? 'Colazione' : (activePage === 'lunch' ? 'Pranzo' : 'Cena');

        return (
            <div className="animate-fade-in max-w-3xl mx-auto pt-6 px-4 md:px-12 pb-24 font-sans">
                <div className="mb-8 flex items-center gap-4 border-b-2 border-gray-100 pb-4">
                    <div className="text-5xl">{emoji}</div>
                    <h1 className="text-4xl font-extrabold text-gray-900">{title}</h1>
                </div>

                <div className="bg-blue-50 p-4 rounded-xl flex items-start gap-4 mb-8 border border-blue-100">
                    <Info className="text-blue-600 flex-shrink-0 mt-1" size={28} />
                    <div className="text-lg text-blue-900 leading-relaxed font-medium">
                        Tocca i riquadri qui sotto per vedere i dettagli e le alternative.
                    </div>
                </div>

                <div className="space-y-4">
                    {data.map((menu, idx) => (
                        <EasyToggle key={idx} title={menu.title}>
                            <div className="pt-2 pb-4 space-y-4">
                                {menu.items.map((item, i) => (
                                    <EasyItem key={i} {...item} />
                                ))}
                                <div className="mt-4 pt-3 border-t border-gray-100 text-lg text-gray-500 italic bg-gray-50 p-3 rounded-lg text-center">
                                    ü•ó Verdura libera a volont√†
                                </div>
                            </div>
                        </EasyToggle>
                    ))}
                </div>
            </div>
        );
    };

    return (
        <div className="flex h-screen w-full bg-[#f9fafb] text-gray-900 overflow-hidden">
             {/* Stili personalizzati */}
             <style>{`
                @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
                
                body { font-family: 'Inter', sans-serif; }

                /* Barra di scorrimento pi√π larga e visibile */
                ::-webkit-scrollbar { width: 12px; height: 12px; }
                ::-webkit-scrollbar-track { background: #f1f1f1; }
                ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 6px; border: 3px solid #f1f1f1; }
                ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
            `}</style>

            {/* HEADER MOBILE (Ben visibile) */}
            <div className="md:hidden fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-20 flex items-center px-4 justify-between shadow-sm">
                <button 
                    onClick={toggleSidebar} 
                    className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg transition-colors"
                >
                    <Menu size={28} />
                    <span className="font-bold text-lg">MENU</span>
                </button>
                <span className="font-bold text-lg text-gray-700">Dieta 1600</span>
            </div>

            {/* Sidebar Backdrop (Mobile) */}
            {isSidebarOpen && (
                <div className="fixed inset-0 bg-black/40 z-30 md:hidden backdrop-blur-sm" onClick={() => setSidebarOpen(false)}></div>
            )}

            {/* SIDEBAR (Menu Laterale) */}
            <div className={`
                fixed md:static inset-y-0 left-0 w-full md:w-80 bg-white border-r border-gray-200 transform transition-transform duration-300 z-40 h-full flex flex-col shadow-2xl md:shadow-none
                ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}
            `}>
                <div className="p-4 flex-1 overflow-y-auto">
                    {/* Pulsante chiudi solo per mobile */}
                    <div className="md:hidden flex justify-end mb-4">
                        <button onClick={() => setSidebarOpen(false)} className="bg-red-100 text-red-700 p-2 rounded-full">
                            <X size={32} />
                        </button>
                    </div>

                    <div className="flex items-center gap-3 px-4 py-4 mb-6 bg-green-50 rounded-xl border border-green-100">
                        <div className="w-10 h-10 bg-green-500 rounded-full text-white flex items-center justify-center text-xl font-bold shadow-sm">D</div>
                        <div>
                            <div className="font-bold text-lg text-green-900">Dieta Personale</div>
                            <div className="text-sm text-green-700">ASST Garda</div>
                        </div>
                    </div>

                    <div className="space-y-2">
                        <div className="text-sm font-bold text-gray-400 px-4 mb-2 uppercase tracking-widest">Sezioni</div>
                        <BigSidebarItem 
                            icon="üìñ" 
                            label="Introduzione" 
                            active={activePage === 'intro'} 
                            onClick={() => { setActivePage('intro'); setSidebarOpen(false); }} 
                        />
                        <BigSidebarItem 
                            icon="‚òï" 
                            label="Colazione" 
                            active={activePage === 'breakfast'} 
                            onClick={() => { setActivePage('breakfast'); setSidebarOpen(false); }} 
                        />
                        <BigSidebarItem 
                            icon="‚òÄÔ∏è" 
                            label="Pranzo" 
                            active={activePage === 'lunch'} 
                            onClick={() => { setActivePage('lunch'); setSidebarOpen(false); }} 
                        />
                        <BigSidebarItem 
                            icon="üåô" 
                            label="Cena" 
                            active={activePage === 'dinner'} 
                            onClick={() => { setActivePage('dinner'); setSidebarOpen(false); }} 
                        />
                    </div>
                </div>
            </div>

            {/* AREA CONTENUTO PRINCIPALE */}
            <div className="flex-1 overflow-y-auto h-full relative scroll-smooth bg-[#f9fafb] mt-16 md:mt-0">
                {renderContent()}
            </div>
        </div>
    );
};

// --- COMPONENTI ADATTATI PER SENIOR ---

const EasyToggle = ({ title, children, defaultOpen = false }) => {
    const [isOpen, setIsOpen] = useState(defaultOpen);

    return (
        <div className="mb-4 bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden">
            <button 
                onClick={() => setIsOpen(!isOpen)}
                className={`w-full flex items-center justify-between p-5 text-left transition-colors ${isOpen ? 'bg-gray-50' : 'bg-white hover:bg-gray-50'}`}
            >
                <span className="font-bold text-xl text-gray-800">{title}</span>
                <div className={`p-2 rounded-full ${isOpen ? 'bg-gray-200 text-gray-700' : 'bg-green-100 text-green-700'}`}>
                    {isOpen ? <Minus size={28} /> : <Plus size={28} />}
                </div>
            </button>
            
            {isOpen && (
                <div className="p-5 border-t border-gray-100 bg-white">
                    {children}
                </div>
            )}
        </div>
    );
};

const EasyItem = ({ name, amount, subs }) => {
    const [showSubs, setShowSubs] = useState(false);
    const hasSubs = subs && subs.length > 0;
    
    return (
        <div className="mb-4 last:mb-0">
            <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center bg-gray-50 p-4 rounded-xl border border-gray-100">
                <div className="mb-2 sm:mb-0">
                    <div className="font-bold text-xl text-gray-900">{name}</div>
                    {hasSubs && (
                        <button 
                            onClick={() => setShowSubs(!showSubs)}
                            className="text-blue-600 font-semibold text-lg mt-1 flex items-center gap-1 hover:underline"
                        >
                            {showSubs ? "Nascondi alternative" : "Vedi alternative"}
                            <ChevronRight size={20} className={`transform transition-transform ${showSubs ? 'rotate-90' : ''}`} />
                        </button>
                    )}
                </div>
                <div className="self-start sm:self-center bg-white border border-gray-200 px-4 py-2 rounded-lg font-mono font-bold text-lg text-gray-700 shadow-sm whitespace-nowrap">
                    {amount}
                </div>
            </div>

            {hasSubs && showSubs && (
                <div className="mt-2 ml-4 pl-4 border-l-4 border-blue-200 space-y-2 py-2 animate-fade-in">
                    <div className="text-gray-500 font-bold uppercase text-sm tracking-wide mb-2">Puoi sostituire con:</div>
                    {subs.map((sub, i) => (
                        <div key={i} className="flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200 shadow-sm">
                            <CornerDownRight size={24} className="text-blue-400 mt-0.5 flex-shrink-0" />
                            <span className="text-lg text-gray-800 leading-tight">{sub}</span>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
};

const BigSidebarItem = ({ icon, label, active, onClick }) => (
    <button 
        onClick={onClick}
        className={`w-full flex items-center gap-4 px-4 py-5 mx-2 rounded-xl transition-all duration-200
        ${active 
            ? 'bg-green-100 text-green-900 shadow-sm border border-green-200' 
            : 'text-gray-600 hover:bg-gray-100 hover:text-gray-900'}`}
    >
        <span className="text-3xl">{icon}</span>
        <span className={`text-xl font-bold ${active ? 'text-green-900' : 'text-gray-700'}`}>{label}</span>
        {active && <ChevronRight className="ml-auto text-green-600" size={24} />}
    </button>
);

export default App;